# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) != x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
xts:::index.xts(SPL.AX[4])
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x != nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x != nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
date(12011)
xts:::index.xts(100)
xts:::index.xts(SPL.AX[10])
ix <- index(trend$Start)
ep <- which(index(SPL.AX) %in% ix)-1
ep
trend[, `:=`(tradeEnd,    lapply(trend[,31],   function(x)  xts:::index.xts(SPL.AX[x+1])))]
trend[,31]
nrow(SPL.AX)
ifelse(4671 != nrow(SPL.AX), "Y", "N"))
ifelse(4671 != nrow(SPL.AX), "Y", "N")
ifelse(4671 = nrow(SPL.AX), "Y", "N")
ifelse(4671 == nrow(SPL.AX), "Y", "N")
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x = nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x = nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) = x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, apply(trend[,30], 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, apply(trend[,30], 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, apply(trend$row, 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
trend$row,
trend$row
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30], 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30], function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30], function(x) xts:::index.xts(SPL.AX[x+1])))]
glimpse(trend)
merge(SPL.AX, trend, by c("index", "start"))
merge(SPL.AX, trend, by=c("index", "start"))
x <- dayDifff(SPL.AX)
x
x <- data.table(dayDifff(SPL.AX))
x
dtSPL$dayDiff <- data.table(dayDifff(SPL.AX))
dtSPL
rm(trend)
dtSPL$row <- dtSPL[, .I[1], by=date][,2]
dtSPL$dayDiff <- data.table(dayDifff(SPL.AX))
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0]
trend
glimpse(trend)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
glimpse(trend)
rm(trend)
ddtSPL
dtSPL
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
glimpse(trend)
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(32:37,39)]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0]
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) if(nrow(SPL.AX != x)) {xts:::index.xts(SPL.AX[x+1])}))]
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) if(nrow(SPL.AX == x)) {xts:::index.xts(SPL.AX[x+1])}))]
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) ifelse(nrow(SPL.AX != x), "y", "n"))]
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) ifelse(nrow(SPL.AX != x), "y", "n")))]
trend
dayDiff
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,1],    function(x) x + trend[,39]))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) if(x != nrow(SPL.AX)) { xts:::index.xts(SPL.AX[x+1])}))]
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, lapply(trend[,31],    function(x) if(x != nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(32:37)]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, lapply(trend[,31],    function(x) if(x != nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, lapply(trend[,31],    function(x) if(x < nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, apply(trend[,31],  1,  function(x) if(x < nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse trend
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
View(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0]
View(trend)
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
View(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
glimpse(trend)
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(32:37)]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
# trend[, `:=`(tradeStart, lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
trend$tradeStart = trend$Start + trend$dayDiff
trend[, `:=`(tradeOpen,   apply( trend[,1], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
glimpse(trend)
trend$tradeEnd = trend$End + trend$i.dayDiff
trend[, `:=`(tradeClose,   apply( trend[,2], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
glimpse(trend)
trendReturns      <- data.table(t(trend[, c(25,13)]))                             # subcatName, return
trendReturns      <- setnames(trendReturns, as.character(trendReturns[1,]))[-1,] %>%
mutate_if(is.character,as.numeric)
View(trendReturns)
dt_trade_stats    <- rbind.data.frame(dXema_trade_stats,
dXsma_trade_stats,
gXema_trade_stats,
gXsma_trade_stats,
nXema_trade_stats,
nXsma_trade_stats
)
View(dt_trade_stats)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
?table.AnnualizedReturns
library(PerformanceAnalytics)
?table.AnnualizedReturns
data("managers")
managers
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
View(trendReturnsAnnualized)
View(trendSummaryDeathSMA)
saveRDS(trendReturnsAnnualized,    file  = here::here("dashboard/rds/", "trendReturnsAnnualized.rds"))
trendSummaryGroup <- head(groupingsets(trend[, c(4:7)], j = c(list(count = .N),
lapply(.SD, sum)), by = c("catName", "indicator"), sets = list(c("catName",
"indicator"), "indicator", character()), id = TRUE), -1)
glimpse(trend)
trendSummaryGroup <- head(groupingsets(trend[, c(1:8)], j = c(list(count = .N),
lapply(.SD, sum)), by = c("catName", "indicator"), sets = list(c("catName",
"indicator"), "indicator", character()), id = TRUE), -1)
################################################################################
## Step 99.00 Create ma table of returns
################################################################################
a <- t(data.table((as.single(lapply(lapply(xtsPrice, na.omit, xtsPrice[1, ]), tail, 1)) - as.single(lapply(lapply(xtsPrice, na.omit, xtsPrice[1, ]), head, 1))) / as.single(lapply(lapply(xtsPrice, na.omit, xtsPrice[1, ]), head, 1))))
colnames(a) <- dimnames(xtsPrice)[[2]]
rownames(a) <- 1
smaReturns <- t(data.table((as.single(lapply(lapply(xtsPriceSMA, na.omit, xtsPrice[1, ]), tail, 1)) - as.single(lapply(lapply(xtsPriceSMA, na.omit, xtsPrice[1, ]), head, 1))) /
as.single(lapply(lapply(xtsPriceSMA, na.omit, xtsPrice[1, ]), head, 1))))
colnames(smaReturns) <- dimnames(xtsPriceSMA)[[2]]
rownames(smaReturns) <- 1
################################################################################
## Step 99.01 EMA Start / End Date
################################################################################
startDate <- data.table(
as.Date.IDate(
t(
lapply(
lapply(xtsPrice, na.omit, xtsPrice[1, ]),
head, 1
),
index
)
endDate <- data.table(
as.Date.IDate(
t(
lapply(
lapply(xtsPrice, na.omit, xtsPrice[1, ]),
tail, 1
),
index
)
countDate <- data.table(lapply(lapply(xtsPrice, na.omit, xtsPrice[1, ]), nrow))
################################################################################
## Step 99.02 SMA Start / End Date
################################################################################
startDateSMA <- data.table(
as.Date.IDate(
t(
lapply(
lapply(xtsPriceSMA, na.omit, xtsPriceSMA[1, ]),
head, 1
),
index
)
endDateSMA <- data.table(
as.Date.IDate(
t(
lapply(
lapply(xtsPriceSMA, na.omit, xtsPriceSMA[1, ]),
tail, 1
),
index
)
countDateSMA <- data.table(lapply(lapply(xtsPriceSMA, na.omit, xtsPriceSMA[1, ]), nrow))
################################################################################
## Step 99.03 transpose EMA
################################################################################
aa <- t(a)
################################################################################
aa <- data.table(aa, keep.rownames = TRUE)
aa <- cbind(aa, startDate, endDate, countDate)
################################################################################
## Reorder Columns by reference
aa <- aa[, c(1, 3:4, 5, 2)]
################################################################################
# Rename Columns ---------------------------------------------------------------
names(aa)[1:5] <- c("subcatName", "startDate", "endDate", "tradeDays", "return")
trend <- aa[, tradeDays := as.integer(tradeDays)] ### rename dataframe and convert column from list to integer
trend <- trend[, catName := substr(aa$subcatName, 1, nchar(aa$subcatName) - 3)] ### add category name sans number(s)
trend[, indicator := "EMA"]
trendEMA <- select(trend, catName, everything()) ### move last column to first
################################################################################
## Step 99.04 transpose SMA
################################################################################
trendSMA <- t(smaReturns)
################################################################################
trendSMA <- data.table(trendSMA, keep.rownames = TRUE)
trendSMA <- cbind(trendSMA, startDateSMA, endDateSMA, countDateSMA)
################################################################################
## Reorder Columns -------------------------------------------------------------
trendSMA <- trendSMA[, c(1, 3:4, 5, 2)]
################################################################################
# Rename Columns --------------------------------------------------------------
names(trendSMA)[1:5] <- c("subcatName", "startDate", "endDate", "tradeDays", "return")
trendSMA <- trendSMA[, tradeDays := as.integer(tradeDays)]                   ### rename dataframe and convert column from list to integer
trendSMA <- trendSMA[, catName := substr(trendSMA$subcatName, 1,
nchar(trendSMA$subcatName) - 3)]                                         ### add category name sans number(s)
trendSMA[, indicator := "SMA"]
trendSMA <- select(trendSMA, catName, everything())                          ### move last column to first
# Trend Test -------------------------------------------------------------------
trend <- rbind.data.frame(trend, trendSMA)
################################################################################
## Step 02.1a Grouping Set aggregation for data tables                       ###
## https://is.gd/ZeSKLS                                                      ###
################################################################################
trendSummaryGroup <- head(groupingsets(trend[, c(4:7)], j = c(list(count = .N),
lapply(.SD, sum)), by = c("catName", "indicator"), sets = list(c("catName",
"indicator"), "indicator", character()), id = TRUE), -1)
View(trendSummaryGroup)
View(trend)
trendSummaryGroup <- readRDS("~/GitHub/splGoldenDeathX/rds/trendSummaryGroup.rds")
View(trendSummaryGroup)
rm(trendSummaryGroup)
trendSummaryGroup <- readRDS("~/GitHub/splGoldenDeathX/rds/trendSummaryGroup.rds")
trendSummaryGroup
glimpse(trend)
trendSummaryGroup <- head(groupingsets(trend[, c(4:7)], j = c(list(count = .N),
lapply(.SD, sum)), by = c("catName", "indicator"), sets = list(c("catName",
"indicator"), "indicator", character()), id = TRUE), -1)
trendSummaryGroup
trendSummaryGroup <- readRDS("~/GitHub/splGoldenDeathX/rds/trendSummaryGroup.rds")
trendSummaryGroup
viewxl:::view_in_xl()
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------
# [1] "Start"               "End"                 "Init.Qty"            "Init.Pos"            "Max.Pos"             "End.Pos"
# [7] "Closing.Txn.Qty"     "Num.Txns"            "Max.Notional.Cost"   "Net.Trading.PL"      "MAE"                 "MFE"
# [13] "Pct.Net.Trading.PL"  "Pct.MAE"             "Pct.MFE"             "tick.Net.Trading.PL" "tick.MAE"            "tick.MFE"
# [19] "duration"            "tradeDays"           "calendarDays"        "catName"             "indicator"           "grp"
# [25] "subcatName"          "open"                "i.open"
# ------------------------------------------------------------------------------
trend   <- trend[, c(23, 22, 25, 1, 26, 2, 27, 13, 9:10, 20:21)]
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
# indicator, catName, subcatName, Start, startOpen, end, endOpen, return, Max.Notational.Cost, Net.Trading.PL, tradeDays#, Calendar Days
names(trend)[c(4,6,8,5,7)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
trend$tradeStart = trend$Start + trend$dayDiff
trend
dtSPL$row <- dtSPL[, .I[1], by=date][,2]
dtSPL$dayDiff <- data.table(dayDifff(SPL.AX))
trend$tradeStart = trend$Start + trend$dayDiff
# [1] "Start"               "End"                 "Init.Qty"            "Init.Pos"            "Max.Pos"             "End.Pos"
# [7] "Closing.Txn.Qty"     "Num.Txns"            "Max.Notional.Cost"   "Net.Trading.PL"      "MAE"                 "MFE"
# [13] "Pct.Net.Trading.PL"  "Pct.MAE"             "Pct.MFE"             "tick.Net.Trading.PL" "tick.MAE"            "tick.MFE"
# [19] "duration"            "tradeDays"           "calendarDays"        "catName"             "indicator"           "grp"
# [25] "subcatName"          "symbol"              "adjusted"            "volume"              "i.adjusted"          "row"
# [31] "dayDiff"             "i.row"               "i.dayDiff"
# ------------------------------------------------------------------------------
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,4],    function(x) xts:::index.xts(SPL.AX[x+1])))]
trend
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------
# [1] "Start"               "End"                 "Init.Qty"            "Init.Pos"            "Max.Pos"             "End.Pos"
# [7] "Closing.Txn.Qty"     "Num.Txns"            "Max.Notional.Cost"   "Net.Trading.PL"      "MAE"                 "MFE"
# [13] "Pct.Net.Trading.PL"  "Pct.MAE"             "Pct.MFE"             "tick.Net.Trading.PL" "tick.MAE"            "tick.MFE"
# [19] "duration"            "tradeDays"           "calendarDays"        "catName"             "indicator"           "grp"
# [25] "subcatName"          "open"                "i.open"
# ------------------------------------------------------------------------------
trend   <- trend[, c(23, 22, 25, 1, 26, 2, 27, 13, 9:10, 20:21)]
trend
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
glimpse(trend)
trend   <- trend[, c(23, 22, 25, 1:2, 27, 13, 9:10, 20:21, 28:29)]
glimpse(trend)
names(trend)[c(4:7,13)] <- c("startDate", "endDate", "startOpen", "return",  "endOpen")
glimpse(trend)
