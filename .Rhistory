index(SPL.AX[trend[2,2]+1])
index(SPL.AX[trend[3,2]+1])
index(SPL.AX[trend[212,2]+1])
index(SPL.AX[trend[1,2]+1])
trend[, `:=`(tradeClose,  apply(trend[,2], 1, function(x) index(SPL.AX[x+1])))]
View(trend)
trend[, `:=`(tradeClose,  apply(trend[,2], 1, function(x) as.date(index(SPL.AX[x+1])))]
trend[, `:=`(tradeClose,  apply(trend[,2], 1, function(x) index(SPL.AX[x+1])))]
trend[, `:=`(tradeClose,  apply(trend[,2], 1, function(x) index(SPL.AX[x])))]
trend
trend[, `:=`(tradeClose,  lapply(trend[,2],  function(x) index(SPL.AX[x])))]
trend[, `:=`(tradeClose,  lapply(trend[,2],  function(x) xts:::index(SPL.AX[x])))]
trend[, `:=`(tradeClose,  lapply(trend[,2],  function(x) xts:::index.xts(SPL.AX[x])))]
trend
trend[, `:=`(tradeClose,  lapply(trend[,2],  function(x) xts:::index(SPL.AX[x+1])))]
Q
trend[, `:=`(tradeStart,  lapply(trend[,2],  function(x) xts:::index.xts(SPL.AX[x+1])))]
trend
View(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
View(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
nrow(SPL.AX)
?if
?IF
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeEnd,  lapply(trend[,2],    function(x) if (nrow(SPL.AX)  != x) {xts:::index.xts(SPL.AX[x+1])}))]
View(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
View(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
traceback()
View(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
traceback()
View(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
traceback()
View(trendReturns)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
traceback()
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
n
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
trend
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
data.table::setkey(trend, end)
trend   <- dtSPL[trend]
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
source('~/GitHub/splGoldenDeathX/splGoldenDeathX.r', echo=TRUE)
glimpse(trend)
trend[,8]
xts:::index.xts(SPL.AX[241])
xts:::index.xts(SPL.AX[4671])
trend[, `:=`(tradeEnd,    lapply(trend[,8],   function(x) ifelse (x = nrow(SPL.AX),xts:::index.xts(SPL.AX[x]),xts:::index.xts(SPL.AX[x+1]))))]
trend[, `:=`(tradeEnd,    lapply(trend[,8],   function(x) ifelse(x = nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
ifelse(4 = nrow(SPL.AX), "Y", "N")
ifelse( nrow(SPL.AX) > 5000, "Y", "N")
rm(trend)
dtSPL$row <- dtSPL[, .I[1], by=date][,2]
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
glimpse
glimpse(trend)
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
data.table::setkey(trend, Start)
trend[dtSPL]
trend[dtSPL, nomatch = 0]
trend[dtSPL, nomatch = 0][,-c(30,35)]
trend[dtSPL, nomatch = 0][,-c(30:35)]
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
glimpse(trend)
trend[, `:=`(tradeStart,  lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
trend[, `:=`(tradeOpen,   apply( trend[,1], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
trend[, `:=`(tradeEnd,    lapply(trend[,32],   function(x) xts:::index.xts(SPL.AX[x+1])))]
trend[, `:=`(tradeClose,  apply(trend[,2], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
glimpse(trend)
trend[, `:=`(tradeClose,   apply( trend[,2], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,31],   function(x)  xts:::index.xts(SPL.AX[x+1])))]
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
# ------------------------------------------------------------------------------
trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart,  lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
trend[, `:=`(tradeOpen,   apply( trend[,1], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
# ------------------------------------------------------------------------------
trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
trend   <- dtSPL[trend][,-c(2:7)]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,31],   function(x)  xts:::index.xts(SPL.AX[x+1])))]
trend[, `:=`(tradeClose,   apply( trend[,2], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
trend[, `:=`(tradeStart,  lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
trend[, `:=`(tradeOpen,   apply( trend[,1], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,31],   function(x)  xts:::index.xts(SPL.AX[x+1])))]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd,    lapply(trend[,31],   function(x)  xts:::index.xts(SPL.AX[x])))]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart,  lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
trend[, `:=`(tradeOpen,   apply( trend[,1], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
trend[, `:=`(tradeClose,   apply( trend[,2], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
glimpse(trend)
class(nrow(SPL.AX))
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
trend
glimpse(trend)
trend[, `:=`(tradeStart,
lapply(trend[,30],
function(x)
ifelse(nrow(SPL.AX) = x,
xts:::index.xts(SPL.AX[x]),
xts:::index.xts(SPL.AX[x+1])
)
]
styler:::style_selection()
tsviz:::tsviz()
styler:::style_selection()
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) = x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
trend[,30]
trend[, `:=`(tradeOpen,   apply( trend[,1], 1, function(x) lag(Op(SPL.AX), -1)[x]))]
trend[,30]
glimpse(trend)
nrow(SPL.AX)
trend[,30]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) != x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
xts:::index.xts(SPL.AX[4])
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x != nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(31:36)]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x != nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
date(12011)
xts:::index.xts(100)
xts:::index.xts(SPL.AX[10])
ix <- index(trend$Start)
ep <- which(index(SPL.AX) %in% ix)-1
ep
trend[, `:=`(tradeEnd,    lapply(trend[,31],   function(x)  xts:::index.xts(SPL.AX[x+1])))]
trend[,31]
nrow(SPL.AX)
ifelse(4671 != nrow(SPL.AX), "Y", "N"))
ifelse(4671 != nrow(SPL.AX), "Y", "N")
ifelse(4671 = nrow(SPL.AX), "Y", "N")
ifelse(4671 == nrow(SPL.AX), "Y", "N")
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x = nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(x = nrow(SPL.AX), xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) = x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, apply(trend[,30], 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, apply(trend[,30], 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, apply(trend$row, 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
trend$row,
trend$row
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30], 1, function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30], function(x) ifelse(nrow(SPL.AX) == x, xts:::index.xts(SPL.AX[x]), xts:::index.xts(SPL.AX[x+1]))))]
glimpse(trend)
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30], function(x) xts:::index.xts(SPL.AX[x+1])))]
glimpse(trend)
merge(SPL.AX, trend, by c("index", "start"))
merge(SPL.AX, trend, by=c("index", "start"))
x <- dayDifff(SPL.AX)
x
x <- data.table(dayDifff(SPL.AX))
x
dtSPL$dayDiff <- data.table(dayDifff(SPL.AX))
dtSPL
rm(trend)
dtSPL$row <- dtSPL[, .I[1], by=date][,2]
dtSPL$dayDiff <- data.table(dayDifff(SPL.AX))
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0]
trend
glimpse(trend)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
glimpse(trend)
rm(trend)
ddtSPL
dtSPL
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
glimpse(trend)
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(32:37,39)]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0]
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) if(nrow(SPL.AX != x)) {xts:::index.xts(SPL.AX[x+1])}))]
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) if(nrow(SPL.AX == x)) {xts:::index.xts(SPL.AX[x+1])}))]
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) ifelse(nrow(SPL.AX != x), "y", "n"))]
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) ifelse(nrow(SPL.AX != x), "y", "n")))]
trend
dayDiff
glimpse(trend)
trend[, `:=`(tradeEnd,    lapply(trend[,1],    function(x) x + trend[,39]))]
# ------------------------------------------------------------------------------
# trend   <- trend[, c(23, 22, 25, 1, 27, 2, 29, 13, 9:10, 20:21)]
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
# trend[, `:=`(tradeStart, lapply(trend[,4],    function(x)  x + 86400))]
trend[, `:=`(tradeStart, lapply(trend[,30],    function(x) xts:::index.xts(SPL.AX[x+1])))]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd,    lapply(trend[,31],    function(x) if(x != nrow(SPL.AX)) { xts:::index.xts(SPL.AX[x+1])}))]
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, lapply(trend[,31],    function(x) if(x != nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
rm(trend)
data.table::setkey(dtSPL, date)
# ------------------------------------------------------------------------------
l       <- list(dXema_trend, dXsma_trend, gXema_trend, gXsma_trend, nXema_trend, nXsma_trend)
trend   <- rbindlist(l)
# ------------------------------------------------------------------------------# https://tinyurl.com/yb29lhr9
trend$Start <- as_date(trend$Start)
trend$End   <- as_date(trend$End)
# ------------------------------------------------------------------------------
# names(trend)[c(1:2,13,27,29)] <- c("startDate", "endDate", "return", "startOpen", "endOpen")
data.table::setkey(trend, Start)
trend      <- trend[dtSPL, nomatch = 0][,-c(30:35)]
data.table::setkey(trend, End)
trend      <- trend[dtSPL, nomatch = 0][,-c(32:37)]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, lapply(trend[,31],    function(x) if(x != nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, lapply(trend[,31],    function(x) if(x < nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
# ------------------------------------------------------------------------------
# data.table::setkey(trend, End)
# trend   <- dtSPL[trend]
# browser()
# trend   <- dtSPL[trend][,-c(2:7)]
# ------------------------------------------------------------------------------
trend[, `:=`(tradeEnd, apply(trend[,31],  1,  function(x) if(x < nrow(SPL.AX)) {xts:::index.xts(SPL.AX[x+1])}))]
glimpse(trend)
